#include "bp.h"
/**************修改如下值*******************/
#define In 10    //输入层In个节点
#define Hide 48  //隐藏层Hide个节点
#define Out 1   //输出层Out个节点
#define Out_divisor  1.0 //输出除数 保持所有输出数据在-1~1内
//double weight_IH[10][48]=   //7.20   
//{
//-0.600000 ,0.054172 ,0.200000 ,0.485469 ,0.870829 ,-0.800000 ,0.100000 ,-0.400000 ,0.943534 ,-0.600000 ,-0.200000 ,0.052097 ,-1.000000 ,0.000000 ,0.700000 ,-0.972628 ,-0.500000 ,0.775230 ,0.402580 ,-0.101334 ,-0.977597 ,-0.600000 ,0.330960 ,0.708439 ,0.700000 ,-0.600000 ,0.512224 ,0.699987 ,0.643614 ,0.613623 ,0.977018 ,-0.564408 ,-0.682524 ,-0.900000 ,-1.054880 ,0.674744 ,-0.100000 ,-0.116196 ,0.894926 ,0.259690 ,-0.179634 ,-0.427146 ,-0.600000 ,-0.200000 ,-0.843805 ,0.400000 ,-0.400122 ,0.145020 ,
//-0.900000 ,-1.094515 ,-0.200000 ,0.641040 ,-0.514589 ,0.000000 ,0.600000 ,0.100000 ,0.925041 ,-0.700000 ,0.200000 ,-0.448758 ,-0.100000 ,0.900000 ,0.800000 ,0.317357 ,0.100000 ,0.887502 ,0.400801 ,-1.000815 ,-1.048561 ,-0.700000 ,0.638353 ,0.549138 ,0.600000 ,-0.600000 ,0.207239 ,0.199996 ,-0.577846 ,1.005900 ,-0.569187 ,-0.435028 ,-0.055023 ,0.200000 ,0.049874 ,0.545797 ,-0.100000 ,0.732638 ,0.698305 ,-0.863903 ,-0.239168 ,0.738747 ,0.300000 ,0.500000 ,0.600860 ,0.600000 ,0.699926 ,0.448059 ,
//-0.400000 ,-0.530985 ,-0.500000 ,-0.420566 ,-0.624694 ,-1.000000 ,0.900000 ,-0.400000 ,0.634877 ,-0.400000 ,-1.000000 ,-0.632760 ,-0.200000 ,0.400000 ,0.100000 ,0.440226 ,-0.000000 ,-0.620618 ,-0.697518 ,0.098680 ,0.731380 ,0.800000 ,0.908065 ,-0.174296 ,0.600000 ,-0.100000 ,0.408072 ,-0.300013 ,0.636921 ,0.093461 ,0.972043 ,0.649821 ,0.331424 ,-0.100000 ,-1.123862 ,-0.244493 ,0.700000 ,-0.620518 ,0.695136 ,-0.656410 ,0.007749 ,0.966638 ,-0.900000 ,0.000000 ,-0.424406 ,0.300000 ,0.599879 ,-0.837994 ,
//-0.000000 ,-1.104240 ,-1.000000 ,-0.054785 ,-1.016879 ,-1.000000 ,-0.100000 ,-1.000000 ,0.529871 ,-1.000000 ,0.600000 ,0.742184 ,0.700000 ,-0.100000 ,0.700000 ,-0.091179 ,-0.600000 ,0.685301 ,0.300882 ,-0.000844 ,-0.053918 ,0.900000 ,1.053171 ,-0.561045 ,-0.200000 ,-0.000000 ,0.809500 ,-1.000004 ,-0.473470 ,-0.081870 ,-0.365943 ,-0.643447 ,0.736652 ,-0.900000 ,0.330935 ,-0.643569 ,-0.300000 ,-0.564192 ,0.098131 ,-0.554236 ,-0.931676 ,-0.757150 ,0.000000 ,0.600000 ,-1.010915 ,-0.600000 ,-0.900077 ,0.437999 ,
//0.500000 ,-0.637716 ,-0.800000 ,0.482185 ,-0.126825 ,-0.500000 ,0.700000 ,-0.400000 ,-0.460944 ,0.200000 ,-0.700000 ,-0.940032 ,0.800000 ,-0.300000 ,0.800000 ,0.734476 ,-0.900000 ,0.077394 ,-0.497469 ,0.498673 ,0.027291 ,-0.400000 ,-0.281610 ,-0.782490 ,0.100000 ,-0.000000 ,-0.089823 ,0.299987 ,-0.559819 ,0.802815 ,-0.725697 ,-0.257089 ,-0.475248 ,0.800000 ,-0.238315 ,-0.635117 ,-0.200000 ,0.281387 ,-0.904957 ,0.251376 ,-0.486454 ,-0.930471 ,0.300000 ,-1.000000 ,0.666690 ,-0.100000 ,-0.000121 ,-0.946186 ,
//-0.900000 ,-0.598565 ,-0.500000 ,-0.957223 ,0.484374 ,-0.900000 ,0.400000 ,-0.200000 ,0.627311 ,0.600000 ,0.100000 ,-0.452996 ,0.400000 ,-0.800000 ,0.200000 ,-0.486210 ,0.600000 ,0.186464 ,0.200834 ,0.299171 ,0.049176 ,-0.500000 ,-0.355484 ,0.244437 ,0.600000 ,-0.300000 ,-0.791623 ,-0.700004 ,0.224220 ,0.511111 ,-0.167823 ,-0.738923 ,0.541122 ,-0.200000 ,-0.458358 ,-0.849140 ,-0.900000 ,-0.366062 ,-0.701764 ,0.040560 ,0.064082 ,0.740535 ,-0.300000 ,-0.100000 ,-0.404358 ,-0.500000 ,0.199924 ,0.043306 ,
//-0.400000 ,0.401354 ,-1.000000 ,0.056939 ,-0.663990 ,-1.000000 ,0.300000 ,-0.600000 ,-0.196960 ,-0.600000 ,-0.900000 ,0.115543 ,0.300000 ,0.900000 ,-0.200000 ,-0.353037 ,-0.300000 ,0.047264 ,0.601926 ,-1.000151 ,0.715303 ,-0.600000 ,-0.084182 ,-0.114231 ,0.500000 ,-0.100000 ,0.821706 ,-0.300008 ,-0.644164 ,-0.345875 ,0.034698 ,-0.638018 ,-0.777891 ,0.200000 ,0.257324 ,0.073509 ,-0.800000 ,0.319347 ,-0.704387 ,-0.363734 ,1.162576 ,0.326073 ,-0.700000 ,-0.800000 ,0.314700 ,-1.000000 ,-0.600014 ,-0.378229 ,
//0.400000 ,0.860584 ,0.500000 ,0.215198 ,0.385641 ,-1.000000 ,-0.800000 ,0.400000 ,0.727086 ,0.900000 ,-0.000000 ,-0.543758 ,-0.500000 ,0.600000 ,-0.300000 ,0.365697 ,-0.800000 ,-0.613159 ,-0.199846 ,0.399950 ,-1.024501 ,-0.500000 ,0.762253 ,-0.752702 ,-0.500000 ,-0.700000 ,0.411594 ,-0.100001 ,-0.979861 ,-0.942048 ,0.412608 ,0.855553 ,0.657682 ,0.100000 ,-0.691774 ,-0.840847 ,-0.900000 ,0.709390 ,-0.900361 ,0.949874 ,0.736669 ,-0.982321 ,-0.800000 ,-0.100000 ,-0.454225 ,-0.100000 ,0.099995 ,-0.649475 ,
//0.200000 ,0.043929 ,-0.300000 ,0.723465 ,0.482864 ,-0.200000 ,-0.400000 ,-0.200000 ,-0.462689 ,-0.600000 ,0.700000 ,-1.060364 ,-0.100000 ,0.600000 ,0.800000 ,-0.448749 ,0.500000 ,-0.216826 ,0.500414 ,0.499928 ,-0.033673 ,-0.600000 ,0.187216 ,-0.874453 ,-0.400000 ,0.500000 ,0.416388 ,-0.100002 ,-0.764820 ,-0.823543 ,-0.181350 ,-0.468411 ,-0.160606 ,-1.000000 ,-0.222693 ,-0.114963 ,-0.700000 ,0.316930 ,0.099135 ,-0.619698 ,-0.350458 ,-0.574683 ,-0.900000 ,-0.400000 ,0.724120 ,0.100000 ,-0.800007 ,0.529412 ,
//-0.800000 ,0.696228 ,-0.900000 ,-0.758568 ,0.860332 ,-0.600000 ,0.600000 ,0.100000 ,-0.705152 ,-0.100000 ,-0.700000 ,0.242442 ,0.700000 ,0.700000 ,0.800000 ,-0.787687 ,-0.000000 ,-0.640993 ,-0.099318 ,-0.900072 ,-1.064891 ,-0.700000 ,0.658720 ,-0.055278 ,0.000000 ,-0.800000 ,-0.412600 ,-0.200003 ,0.806278 ,0.954127 ,-0.966921 ,0.713484 ,0.453974 ,-1.000000 ,0.020748 ,0.671611 ,-0.000000 ,0.828570 ,-0.201428 ,0.647446 ,-0.596636 ,0.453762 ,-0.600000 ,-0.900000 ,-0.856550 ,-0.100000 ,-0.100007 ,0.019784 ,

//};
//double bias_H[48]=
//{
//0.457465 ,
//0.210742 ,
//0.729565 ,
//0.683197 ,
//0.091260 ,
//0.789516 ,
//0.969888 ,
//-0.062898 ,
//0.887140 ,
//0.380614 ,
//-0.062898 ,
//-0.081407 ,
//1.006798 ,
//0.487011 ,
//0.021490 ,
//-0.248715 ,
//0.208627 ,
//0.402521 ,
//0.257399 ,
//-0.308118 ,
//0.518219 ,
//0.410986 ,
//0.729874 ,
//0.698653 ,
//0.536394 ,
//0.671288 ,
//0.572851 ,
//0.729565 ,
//0.754544 ,
//0.635937 ,
//0.469506 ,
//0.289746 ,
//0.232364 ,
//0.657447 ,
//0.092616 ,
//0.702774 ,
//-0.139632 ,
//0.213401 ,
//0.109663 ,
//0.556688 ,
//0.722406 ,
//0.274152 ,
//0.206451 ,
//0.413857 ,
//0.074622 ,
//-0.137235 ,
//-0.020674 ,
//0.383658 ,

//};
//double weight_HO[48][1]=
//{
//-0.415755 ,
//-0.508229 ,
//-0.144362 ,
//0.396932 ,
//-0.653343 ,
//0.063649 ,
//1.561950 ,
//-1.428588 ,
//0.652584 ,
//-0.062176 ,
//-1.428588 ,
//-0.461658 ,
//0.713333 ,
//-0.105215 ,
//-0.064685 ,
//-1.120724 ,
//-0.305889 ,
//-0.364058 ,
//0.903358 ,
//-1.602942 ,
//-0.398588 ,
//0.324434 ,
//1.306006 ,
//-0.916133 ,
//0.666996 ,
//-1.019955 ,
//0.333409 ,
//-0.144355 ,
//0.806833 ,
//0.962075 ,
//0.005483 ,
//-0.710931 ,
//-0.533596 ,
//-0.070607 ,
//-1.155128 ,
//0.665574 ,
//-0.795593 ,
//0.762976 ,
//-0.563977 ,
//0.717930 ,
//0.329216 ,
//0.351156 ,
//-0.024476 ,
//0.042735 ,
//-1.233876 ,
//-0.746942 ,
//-1.555583 ,
//-0.527983 ,

//};
//	double bias_O[1]=
//	{
//1.163681 ,

//};



double weight_IH[10][48]=   //7.20   
{
-0.161505 ,-0.676825 ,0.832845 ,0.508061 ,-0.205232 ,0.454817 ,0.907550 ,-0.433486 ,-0.701547 ,0.019430 ,0.390423 ,0.394212 ,-0.793052 ,0.284511 ,0.017749 ,-0.512983 ,-0.831756 ,0.205828 ,-0.176731 ,0.881118 ,-0.781492 ,-0.312048 ,0.600724 ,1.165074 ,-0.909828 ,0.560614 ,0.692051 ,-0.451335 ,0.619352 ,-0.951837 ,-0.866019 ,0.438602 ,-0.333917 ,0.361201 ,0.152687 ,-0.853334 ,-0.624517 ,-0.948753 ,-0.311363 ,0.545090 ,-0.511340 ,-0.258333 ,-0.377358 ,0.270023 ,-0.579245 ,-0.040033 ,-0.776728 ,-0.221802 ,
-0.648374 ,-0.687875 ,0.913336 ,-0.995439 ,-0.910241 ,0.739351 ,-1.263384 ,-0.568141 ,-0.305169 ,-0.060262 ,0.890734 ,-0.311553 ,0.400302 ,0.663814 ,0.491338 ,1.965972 ,0.447047 ,0.511681 ,0.735127 ,-0.527708 ,-1.020798 ,1.190312 ,-0.226812 ,-1.683964 ,1.258068 ,0.002907 ,-0.314754 ,-0.942031 ,0.018443 ,-0.243428 ,0.261242 ,-0.233597 ,0.144585 ,-0.270008 ,0.307246 ,-0.001264 ,-0.234340 ,0.371582 ,-0.643464 ,0.678773 ,-0.286823 ,1.076412 ,-1.250406 ,0.674947 ,-0.361005 ,0.020673 ,-0.286616 ,-0.602347 ,
-0.203329 ,-0.111577 ,0.025128 ,0.014593 ,-0.105211 ,-1.099844 ,-0.626419 ,-0.430605 ,-0.401202 ,-0.380572 ,0.523959 ,-0.405773 ,0.905300 ,0.601972 ,-0.575001 ,0.420330 ,-0.612593 ,0.005827 ,-0.241232 ,-0.994310 ,-0.373341 ,0.281479 ,0.544170 ,-0.171843 ,0.465820 ,0.825066 ,0.292036 ,0.419892 ,-0.183640 ,-0.906461 ,0.727407 ,0.335041 ,-0.561718 ,0.240445 ,0.246009 ,0.047508 ,0.156686 ,0.768192 ,-0.711338 ,0.637259 ,-0.859313 ,0.786685 ,-0.255479 ,-0.558793 ,-0.752088 ,0.124402 ,-0.172257 ,-0.153477 ,
0.616185 ,-0.599261 ,0.217209 ,-0.717693 ,-0.610260 ,-0.164187 ,0.935077 ,0.526951 ,0.594034 ,0.939741 ,-0.682090 ,-0.611559 ,-1.155985 ,-1.063570 ,-0.318025 ,-0.998530 ,-0.796649 ,-0.588304 ,-0.982549 ,-0.388163 ,0.036588 ,-1.193071 ,0.970834 ,1.404300 ,-1.859294 ,0.723865 ,0.385274 ,0.289092 ,-0.472570 ,0.747497 ,-0.637749 ,1.010780 ,0.123251 ,-0.722323 ,-0.073641 ,-0.302491 ,0.202010 ,-0.731401 ,0.556088 ,-0.603808 ,0.852664 ,0.196010 ,1.227209 ,-0.177361 ,-0.693156 ,0.272071 ,-0.995257 ,-0.935917 ,
0.216903 ,0.360880 ,-0.471509 ,0.919549 ,0.094785 ,-1.081864 ,-0.126404 ,0.567862 ,-0.701361 ,0.619428 ,-0.289301 ,-0.805774 ,-0.077751 ,-1.081003 ,-0.677715 ,0.129414 ,-0.385541 ,0.605828 ,-0.299750 ,0.173643 ,-0.776036 ,0.117102 ,-0.635657 ,-1.104810 ,0.531288 ,-0.955324 ,-0.907964 ,-0.271855 ,-0.782339 ,-0.922485 ,0.731725 ,-0.566627 ,-0.493622 ,0.479851 ,0.448086 ,0.647368 ,0.146831 ,0.663911 ,-0.711339 ,0.136499 ,0.299918 ,-0.609224 ,0.465330 ,0.333652 ,-0.560515 ,0.639101 ,-0.973617 ,0.455672 ,
-1.127076 ,0.159443 ,0.514570 ,0.891055 ,0.089758 ,0.077737 ,-0.519153 ,-0.270140 ,0.094433 ,-0.560262 ,-0.450960 ,0.188446 ,0.731222 ,0.101734 ,0.187765 ,-0.614498 ,0.002036 ,0.811688 ,-0.611879 ,-0.098312 ,0.059609 ,0.541645 ,-0.480731 ,-0.258603 ,0.715193 ,-0.355186 ,-0.014754 ,0.173909 ,0.222282 ,0.611794 ,0.561866 ,-0.118092 ,-0.745681 ,-0.115947 ,-0.184641 ,0.298441 ,0.727719 ,-0.125528 ,-0.143468 ,-0.910333 ,-0.291067 ,1.190306 ,-0.096332 ,-0.326450 ,0.132140 ,0.441357 ,-0.090426 ,-0.011893 ,
0.189382 ,-0.826611 ,-0.132147 ,-0.133753 ,-0.003748 ,-0.340190 ,-0.025199 ,-0.907630 ,-0.402183 ,0.306337 ,-0.494149 ,-0.503308 ,0.295762 ,0.053492 ,-0.935248 ,-0.035461 ,0.508619 ,0.901100 ,0.646126 ,-0.438371 ,-1.005161 ,-0.107350 ,0.603992 ,-0.071452 ,0.126517 ,0.630112 ,0.393271 ,-0.708142 ,-0.759387 ,-0.355671 ,0.919179 ,-1.126832 ,-0.224946 ,-1.017798 ,0.173949 ,-0.602237 ,0.120353 ,-0.890657 ,-0.166062 ,0.549814 ,0.048338 ,-0.236874 ,-0.287662 ,-0.063260 ,-0.997392 ,0.407007 ,-0.026991 ,0.369352 ,
0.983754 ,0.188512 ,-0.153152 ,0.097520 ,-0.303658 ,-1.077286 ,-0.202384 ,-0.007183 ,-0.601081 ,0.506331 ,-0.286309 ,0.096713 ,0.754447 ,-0.327951 ,-0.222244 ,1.679033 ,0.912470 ,0.201098 ,0.627465 ,0.815513 ,0.605538 ,0.420463 ,-0.243026 ,-0.155759 ,-0.225498 ,-0.679000 ,-0.106729 ,-0.879594 ,-0.932654 ,-0.266319 ,-0.482199 ,-0.659039 ,0.152905 ,-0.800364 ,0.931129 ,-1.001810 ,-0.967662 ,-0.415190 ,0.534052 ,0.734281 ,0.003847 ,-0.482508 ,0.949447 ,1.402892 ,-0.347770 ,0.820107 ,0.623316 ,1.329350 ,
0.779472 ,0.452221 ,0.022382 ,0.115188 ,-0.005155 ,0.635029 ,0.475925 ,-0.333734 ,0.897131 ,0.719350 ,0.807236 ,0.494220 ,-0.784572 ,0.529874 ,0.035275 ,0.029443 ,-0.291188 ,0.105842 ,-0.464709 ,1.304251 ,0.795327 ,-0.028529 ,0.417752 ,-0.047346 ,0.048190 ,0.637541 ,0.491673 ,0.851785 ,-0.458982 ,-0.296804 ,0.527416 ,0.542375 ,0.621339 ,0.342877 ,-0.332687 ,-0.915775 ,1.134687 ,0.825190 ,-1.011809 ,-0.390076 ,-0.130993 ,0.094223 ,0.296921 ,-0.244502 ,0.553996 ,0.597113 ,-0.146780 ,0.346383 ,
0.494652 ,0.847214 ,0.638220 ,0.422840 ,-0.605160 ,0.693487 ,-0.144086 ,-0.039719 ,-0.802933 ,0.319352 ,0.891099 ,-0.805781 ,0.271327 ,-0.301319 ,-0.666154 ,-0.423528 ,0.045163 ,0.105842 ,0.111003 ,0.589698 ,0.776079 ,0.012721 ,-0.518937 ,-0.116034 ,0.171709 ,-1.040356 ,0.791699 ,0.072410 ,0.664234 ,0.486422 ,0.627623 ,-0.975054 ,0.460824 ,0.205020 ,0.473550 ,-0.216300 ,-0.186742 ,-1.079412 ,-0.711812 ,-0.649550 ,0.005260 ,-0.023898 ,0.663711 ,-0.572206 ,0.671842 ,-0.730622 ,0.690484 ,-0.344211 ,

};
double bias_H[48]=
{
0.265952 ,
0.729509 ,
-0.006017 ,
0.412604 ,
0.405120 ,
0.532305 ,
0.361546 ,
0.530506 ,
0.101458 ,
0.280654 ,
0.228072 ,
0.805769 ,
0.634489 ,
1.080365 ,
0.343900 ,
1.489303 ,
0.674574 ,
0.294173 ,
0.358085 ,
0.051277 ,
0.113560 ,
1.172487 ,
0.504142 ,
0.451307 ,
1.413209 ,
0.369222 ,
0.408344 ,
0.878717 ,
0.779487 ,
0.768028 ,
0.273222 ,
0.007674 ,
0.358089 ,
0.835895 ,
0.064701 ,
0.414228 ,
0.825172 ,
0.062134 ,
0.911337 ,
0.414165 ,
-0.289216 ,
0.281942 ,
0.158636 ,
0.444607 ,
0.306091 ,
0.852083 ,
0.802878 ,
0.548833 ,

};
double weight_HO[48][1]=
{
1.642972 ,
0.941426 ,
-1.015652 ,
0.115275 ,
0.793478 ,
-0.587979 ,
-2.387158 ,
0.638580 ,
-0.076014 ,
-1.101889 ,
0.494052 ,
0.487963 ,
3.117449 ,
1.709511 ,
0.485827 ,
2.937038 ,
-0.421662 ,
-0.930005 ,
1.613568 ,
-2.984355 ,
0.705784 ,
2.666652 ,
-1.711997 ,
-3.090596 ,
1.741480 ,
-2.449313 ,
-0.556376 ,
-0.890510 ,
-0.456172 ,
0.259074 ,
-1.192675 ,
-2.668133 ,
0.895798 ,
-1.767671 ,
-1.021247 ,
0.192267 ,
1.926014 ,
0.550781 ,
0.674485 ,
-0.374809 ,
-2.296948 ,
3.120895 ,
-1.974188 ,
-2.518478 ,
0.509098 ,
-1.170001 ,
0.162169 ,
1.693269 ,


};
	double bias_O[1]=
	{
1.560392 ,


};

/******************************************/
//激活函数
static double sigmoid(double x)
{
    double tmp = 1.0 / (1.0 + exp(-x));
    return tmp;
}
 
//获取单节点输出 数据首地址 数据列数 权值首地址 权值列数 偏置
static double getOneNodeValue(double *value, int valueColumn, double *weight, int weightColumn, double bias)
{
    int i = 0 ;double tmp = 0.0;
    for (i = 0 ; i < valueColumn ; i++)
        tmp += *(value+i) * *(weight+i * weightColumn); //x1*w1 + x2*w2 + x3*w3 + ....
    tmp -= bias; //偏置+
    return sigmoid(tmp);
}

 void bp_judge(double *data, double *output)
{
    int i;
    double hide[Hide] = {0};
    for(i=0;i<Hide;i++) {
        hide[i] = getOneNodeValue(data, In, *weight_IH+i, Hide, bias_H[i]); 
    }
    for(i=0;i<Out;i++) {
        output[i] = getOneNodeValue(hide, Hide, *weight_HO+i, Out, bias_O[i]) * Out_divisor; 
    }
}



